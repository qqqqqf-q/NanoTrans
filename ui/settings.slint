// NanoTrans Settings Window
// Clean, unified provider configuration

import { VerticalBox, HorizontalBox, LineEdit, ComboBox, ScrollView } from "std-widgets.slint";
import { Theme } from "./theme.slint";

export component SettingsWindow inherits Window {
    title: "NanoTrans Settings";
    width: 600px;
    height: 700px;
    background: Theme.background-main;

    // Properties
    in-out property <string> hotkey: "Alt+Q";
    in-out property <int> provider-index: 0;
    in-out property <string> api-key: "";
    in-out property <string> api-base: "";
    in-out property <string> model: "";
    in property <[string]> provider-names: ["Google Translate", "DeepL", "Zhipu GLM", "OpenAI", "Anthropic", "Custom"];
    in property <int> provider-type: 0;

    // Language selection
    in-out property <int> language-index: 0;
    in property <[string]> language-names: ["Auto", "English", "中文"];

    // I18N text properties
    in property <string> i18n-title: "Settings";
    in property <string> i18n-hotkey: "Global Hotkey";
    in property <string> i18n-provider: "Translation Provider";
    in property <string> i18n-provider-settings: "Provider Settings";
    in property <string> i18n-google-hint: "Google Translate - no config needed";
    in property <string> i18n-deepl-settings: "DeepL Settings";
    in property <string> i18n-api-key: "API Key";
    in property <string> i18n-api-key-placeholder: "Enter your API key";
    in property <string> i18n-deepl-hint: "Get your free API key at deepl.com/pro-api";
    in property <string> i18n-api-settings: "API Settings";
    in property <string> i18n-api-base: "API Base URL";
    in property <string> i18n-model: "Model";
    in property <string> i18n-model-placeholder: "e.g., gpt-4o-mini";
    in property <string> i18n-cancel: "Cancel";
    in property <string> i18n-save: "Save";
    in property <string> i18n-language: "UI Language";

    // Callbacks
    callback save-settings();
    callback cancel-settings();
    callback provider-selected(int);
    callback language-selected(int);

    VerticalBox {
        padding: Theme.padding-large;
        spacing: Theme.padding-medium;

        // Title
        Text {
            text: root.i18n-title;
            color: Theme.text-primary;
            font-size: Theme.font-size-large;
            font-weight: 700;
        }

        ScrollView {
            viewport-height: content.preferred-height;
            
            content := VerticalBox {
                spacing: Theme.padding-medium;

                // UI Language
                Rectangle {
                    background: #FFFFFF05; // Glass effect
                    border-radius: Theme.radius-medium;
                    border-width: 1px;
                    border-color: Theme.border-subtle;
                    height: 80px;

                    VerticalBox {
                        padding: Theme.padding-medium;
                        spacing: Theme.padding-small;

                        Text {
                            text: root.i18n-language;
                            color: Theme.text-secondary;
                            font-size: Theme.font-size-small;
                        }

                        ComboBox {
                            model: root.language-names;
                            current-index <=> root.language-index;
                            selected(val) => {
                                root.language-selected(root.language-index);
                            }
                        }
                    }
                }

                // Hotkey
                Rectangle {
                    background: #FFFFFF05;
                    border-radius: Theme.radius-medium;
                    border-width: 1px;
                    border-color: Theme.border-subtle;
                    height: 80px;

                    VerticalBox {
                        padding: Theme.padding-medium;
                        spacing: Theme.padding-small;

                        Text {
                            text: root.i18n-hotkey;
                            color: Theme.text-secondary;
                            font-size: Theme.font-size-small;
                        }

                        LineEdit {
                            text <=> root.hotkey;
                            placeholder-text: "Alt+Q";
                        }
                    }
                }

                // Provider Selection
                Rectangle {
                    background: #FFFFFF05;
                    border-radius: Theme.radius-medium;
                    border-width: 1px;
                    border-color: Theme.border-subtle;
                    height: 80px;

                    VerticalBox {
                        padding: Theme.padding-medium;
                        spacing: Theme.padding-small;

                        Text {
                            text: root.i18n-provider;
                            color: Theme.text-secondary;
                            font-size: Theme.font-size-small;
                        }

                        ComboBox {
                            model: root.provider-names;
                            current-index <=> root.provider-index;
                            selected(val) => {
                                root.provider-selected(root.provider-index);
                            }
                        }
                    }
                }

                // Provider Config - Dynamic based on type
                Rectangle {
                    background: #FFFFFF05;
                    border-radius: Theme.radius-medium;
                    border-width: 1px;
                    border-color: Theme.border-subtle;
                    vertical-stretch: 1;

                    VerticalBox {
                        padding: Theme.padding-medium;
                        spacing: Theme.padding-medium;

                        // Google - No config needed
                        if root.provider-type == 0 : VerticalBox {
                            spacing: Theme.padding-small;

                            Text {
                                text: root.i18n-provider-settings;
                                color: Theme.text-secondary;
                                font-size: Theme.font-size-small;
                            }

                            Rectangle {
                                background: #FFFFFF05;
                                border-radius: Theme.radius-small;
                                height: 50px;
                                border-width: 1px;
                                border-color: Theme.accent-primary;

                                HorizontalBox {
                                    padding: Theme.padding-small;
                                    Text {
                                        text: root.i18n-google-hint;
                                        color: Theme.accent-hover;
                                        font-size: Theme.font-size-body;
                                        vertical-alignment: center;
                                    }
                                }
                            }
                        }

                        // DeepL - Only API Key
                        if root.provider-type == 1 : VerticalBox {
                            spacing: 12px;

                            Text {
                                text: root.i18n-deepl-settings;
                                color: Theme.text-secondary;
                                font-size: Theme.font-size-small;
                            }

                            VerticalBox {
                                spacing: 4px;
                                Text {
                                    text: root.i18n-api-key;
                                    color: Theme.text-placeholder;
                                    font-size: 11px;
                                }
                                LineEdit {
                                    text <=> root.api-key;
                                    placeholder-text: root.i18n-api-key-placeholder;
                                    input-type: password;
                                }
                            }

                            Text {
                                text: root.i18n-deepl-hint;
                                color: Theme.text-placeholder;
                                font-size: 10px;
                            }
                        }

                        // LLM Providers (Zhipu, OpenAI, Anthropic, Custom)
                        if root.provider-type >= 2 : VerticalBox {
                            spacing: 12px;

                            Text {
                                text: root.i18n-api-settings;
                                color: Theme.text-secondary;
                                font-size: Theme.font-size-small;
                            }

                            // API Base (only for Custom)
                            if root.provider-type == 5 : VerticalBox {
                                spacing: 4px;
                                Text {
                                    text: root.i18n-api-base;
                                    color: Theme.text-placeholder;
                                    font-size: 11px;
                                }
                                LineEdit {
                                    text <=> root.api-base;
                                    placeholder-text: "https://api.example.com/v1";
                                }
                            }

                            // Model
                            VerticalBox {
                                spacing: 4px;
                                Text {
                                    text: root.i18n-model;
                                    color: Theme.text-placeholder;
                                    font-size: 11px;
                                }
                                LineEdit {
                                    text <=> root.model;
                                    placeholder-text: root.i18n-model-placeholder;
                                }
                            }

                            // API Key
                            VerticalBox {
                                spacing: 4px;
                                Text {
                                    text: root.i18n-api-key;
                                    color: Theme.text-placeholder;
                                    font-size: 11px;
                                }
                                LineEdit {
                                    text <=> root.api-key;
                                    placeholder-text: root.i18n-api-key-placeholder;
                                    input-type: password;
                                }
                            }
                        }
                    }
                }
            }
        }

        // Buttons
        HorizontalBox {
            alignment: end;
            spacing: Theme.padding-small;
            height: 44px;

            Rectangle {
                width: 100px;
                height: 40px;
                border-radius: Theme.radius-small;
                background: cancel-area.has-hover ? Theme.background-overlay : transparent;
                border-width: 1px;
                border-color: Theme.border-subtle;
                animate background { duration: 150ms; }

                Text {
                    text: root.i18n-cancel;
                    color: Theme.text-secondary;
                    font-size: Theme.font-size-body;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }

                cancel-area := TouchArea {
                    clicked => { root.cancel-settings(); }
                }
            }

            Rectangle {
                width: 100px;
                height: 40px;
                border-radius: Theme.radius-small;
                background: save-area.has-hover ? Theme.accent-hover : Theme.accent-primary;
                animate background { duration: 150ms; }

                Text {
                    text: root.i18n-save;
                    color: #FFFFFF;
                    font-size: Theme.font-size-body;
                    font-weight: 600;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }

                save-area := TouchArea {
                    clicked => { root.save-settings(); }
                }
            }
        }
    }
}
